#! /bin/sh

# make sure we have a machine-id (needed by netflix addon)
[ "$(stat -c %s machine-id)" != "0" ] || $SNAP/usr/bin/uuidgen | tr -d - >$SNAP_COMMON/.machine-id

# always power on bluetooth if we can access it
if snapctl is-connected bluez; then
  $SNAP/bin/echo -e 'power on' | $SNAP/usr/bin/bluetoothctl >/dev/null 2>&1 || true
  # allow pulse to switch to BT audio devices on connect
  if snapctl is-connected audio-playback; then
    # only load the module if it is not there yet
    if ! $SNAP/usr/bin/pactl list short | grep -q module-switch-on-connect; then
      $SNAP/usr/bin/pactl load-module module-switch-on-connect >/dev/null 2>&1 || true
	fi
  fi
fi

exec "$@"
